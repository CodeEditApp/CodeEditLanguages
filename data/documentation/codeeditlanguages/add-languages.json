{"metadata":{"title":"Add Languages","roleHeading":"Article","modules":[{"name":"CodeEditLanguages"}],"role":"article"},"hierarchy":{"paths":[["doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages"],["doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages","doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage"]]},"identifier":{"interfaceLanguage":"swift","url":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/Add-Languages"},"primaryContentSections":[{"kind":"content","content":[{"anchor":"Overview","level":2,"type":"heading","text":"Overview"},{"inlineContent":[{"text":"First of all have a look at the corresponding ","type":"text"},{"identifier":"https:\/\/github.com\/CodeEditApp\/CodeEditTextView\/issues\/15","isActive":true,"type":"reference"},{"type":"text","text":" to see which languages still need implementation."}],"type":"paragraph"},{"style":"note","type":"aside","name":"Note","content":[{"inlineContent":[{"type":"text","text":"If you want to update existing languages see "},{"type":"reference","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/Update-Languages","isActive":true},{"type":"text","text":" instead."}],"type":"paragraph"}]},{"anchor":"Add-SPM-support","text":"Add SPM support","level":2,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"If you find one you want to add, fork and clone the linked repo and create a new branch ","type":"text"},{"type":"codeVoice","code":"feature\/spm"},{"type":"text","text":"."}]},{"type":"aside","content":[{"inlineContent":[{"text":"In the following code samples replace ","type":"text"},{"type":"codeVoice","code":"{LANG}"},{"type":"text","text":" or "},{"type":"codeVoice","code":"{lang}"},{"text":" with the language you add (e.g.: ","type":"text"},{"code":"Swift","type":"codeVoice"},{"text":" or ","type":"text"},{"type":"codeVoice","code":"CPP"},{"type":"text","text":" and "},{"type":"codeVoice","code":"swift"},{"type":"text","text":" or "},{"code":"cpp","type":"codeVoice"},{"type":"text","text":" respectively)"}],"type":"paragraph"}],"style":"tip","name":"Tip"},{"level":3,"type":"heading","text":".gitignore","anchor":"gitignore"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Edit the "},{"type":"codeVoice","code":".gitignore"},{"text":" file to exclude the ","type":"text"},{"code":".build\/","type":"codeVoice"},{"text":" directory from git.","type":"text"}]},{"text":"Package.swift","type":"heading","anchor":"Packageswift","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Create a new file "},{"type":"codeVoice","code":"Package.swift"},{"text":" in the ","type":"text"},{"code":"root","type":"codeVoice"},{"text":" directory of the repository and add the following configuration.","type":"text"}]},{"style":"warning","type":"aside","name":"Warning","content":[{"type":"paragraph","inlineContent":[{"text":"Make sure to remove the comment in ‘sources’.","type":"text"}]}]},{"syntax":"swift","code":["\/\/ swift-tools-version:5.3","import PackageDescription","","let package = Package(","    name: \"TreeSitter{LANG}\",","    platforms: [.macOS(.v10_13), .iOS(.v11)],","    products: [","        .library(name: \"TreeSitter{LANG}\", targets: [\"TreeSitter{LANG}\"]),","    ],","    dependencies: [],","    targets: [","        .target(name: \"TreeSitter{LANG}\",","                path: \".\",","                exclude: [","                    \"binding.gyp\",","                    \"bindings\",","                    \"Cargo.toml\",","                    \"corpus\",","                    \"examples\",","                    \"grammar.js\",","                    \"LICENSE\",","                    \"Makefile\",","                    \"package.json\",","                    \"README.md\",","                    \"src\/grammar.json\",","                    \"src\/node-types.json\",","                    \/\/ any additional files to exclude ","                ],","                sources: [","                    \"src\/parser.c\",","                    \"src\/scanner.cc\", \/\/ this might be `scanner.c` or not present at all","                ],","                resources: [","                    .copy(\"queries\")","                ],","                publicHeadersPath: \"bindings\/swift\",","                cSettings: [.headerSearchPath(\"src\")])","    ]",")"],"type":"codeListing"},{"type":"heading","anchor":"Swift-Bindings","text":"Swift Bindings","level":3},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now you need to create the Swift bindings which are a "},{"type":"codeVoice","code":"header"},{"text":" file exposing the ","type":"text"},{"code":"tree_sitter_{lang}()","type":"codeVoice"},{"type":"text","text":" function."}]},{"inlineContent":[{"text":"First of all create the following directories inside the ","type":"text"},{"type":"codeVoice","code":"bindings\/"},{"type":"text","text":" directory:"}],"type":"paragraph"},{"type":"paragraph","inlineContent":[{"type":"codeVoice","code":".\/bindings\/swift\/TreeSitter{LANG}\/"}]},{"type":"paragraph","inlineContent":[{"text":"Inside that folder create a new header file called ","type":"text"},{"type":"codeVoice","code":"{lang}.h"},{"type":"text","text":"."}]},{"code":["#ifndef TREE_SITTER_{LANG}_H_","#define TREE_SITTER_{LANG}_H_","","typedef struct TSLanguage TSLanguage;","","#ifdef __cplusplus","extern \"C\" {","#endif","","extern TSLanguage *tree_sitter_{lang}();","","#ifdef __cplusplus","}","#endif","","#endif \/\/ TREE_SITTER_{LANG}_H_"],"type":"codeListing","syntax":"cpp"},{"anchor":"Add-it-to-CodeEditLanguages","type":"heading","level":2,"text":"Add it to CodeEditLanguages"},{"type":"paragraph","inlineContent":[{"type":"text","text":"In order to add a language to "},{"type":"reference","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages","isActive":true},{"text":" you need to open the ","type":"text"},{"code":".xcodeproj","type":"codeVoice"},{"text":" file located inside ","type":"text"},{"type":"codeVoice","code":"CodeLanguage-Container"},{"type":"text","text":"."}]},{"inlineContent":[{"type":"image","identifier":"xcodeproj-location"}],"type":"paragraph"},{"type":"orderedList","items":[{"content":[{"type":"paragraph","inlineContent":[{"text":"Add the ","type":"text"},{"type":"codeVoice","code":"tree-sitter"},{"text":" package you created earlier as a dependency like you would in a regular Xcode project.","type":"text"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Then make sure the framework target loads the package module."}]}]},{"content":[{"type":"paragraph","inlineContent":[{"text":"Now open the ","type":"text"},{"type":"codeVoice","code":"CodeLanguages_Container.h"},{"type":"text","text":" header file and add:"}]},{"type":"codeListing","syntax":"cpp","code":["extern TSLanguage *tree_sitter_{lang}();"]},{"name":"Important","style":"important","type":"aside","content":[{"type":"paragraph","inlineContent":[{"text":"Please keep an alphabetical order","type":"text"}]}]}]},{"content":[{"inlineContent":[{"text":"Now create the ","type":"text"},{"type":"codeVoice","code":"xcframework"},{"type":"text","text":" by running the "},{"type":"codeVoice","code":"build_framework.sh"},{"text":" script from the Package’s root directory.","type":"text"}],"type":"paragraph"},{"syntax":"bash","type":"codeListing","code":["$ .\/build_framework.sh"]},{"style":"note","name":"Note","type":"aside","content":[{"type":"paragraph","inlineContent":[{"text":"To run the script, you need to install ","type":"text"},{"type":"codeVoice","code":"jq"},{"text":" by downloading it ","type":"text"},{"identifier":"https:\/\/stedolan.github.io\/jq\/","isActive":true,"type":"reference"},{"text":" or with Homebrew using:","type":"text"}]},{"syntax":"bash","code":["$ brew install jq"],"type":"codeListing"}]}]},{"content":[{"inlineContent":[{"type":"text","text":"Check the output of the script. It should say "},{"type":"codeVoice","code":"Done!"},{"type":"text","text":" at the end."},{"type":"text","text":" "},{"type":"image","identifier":"build-output"}],"type":"paragraph"},{"type":"aside","style":"tip","name":"Tip","content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"If this does not succeed, try running the script using the "},{"type":"codeVoice","code":"--debug"},{"text":" flag to get verbose output:","type":"text"}]},{"type":"codeListing","code":["$ .\/build_framework.sh --debug"],"syntax":"bash"}]}]},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"You are now done in the Xcode Project and may close it now. Open the Package and continue."}]}]}]},{"type":"heading","level":2,"text":"Add it to CodeLanguage","anchor":"Add-it-to-CodeLanguage"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now move over to the "},{"type":"codeVoice","code":"Sources\/CodeEditLanguages"},{"text":" folder where 3 files need to be updated.","type":"text"}]},{"type":"heading","level":3,"text":"TreeSitterLanguage.swift","anchor":"TreeSitterLanguageswift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Add a case for your language to "},{"isActive":true,"type":"reference","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterLanguage"},{"type":"text","text":":"}]},{"type":"codeListing","code":["public enum TreeSitterLanguage: String {","    \/\/ other cases","    case {lang}","}"],"syntax":"swift"},{"level":3,"text":"CodeLanguage.swift","type":"heading","anchor":"CodeLanguageswift"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Find the "},{"type":"codeVoice","code":"tsLanguage"},{"text":" computed property and add a ","type":"text"},{"code":"case","type":"codeVoice"},{"type":"text","text":" to it:"}]},{"type":"codeListing","syntax":"swift","code":["private var tsLanguage: UnsafeMutablePointer<TSLanguage>? {","    switch id {","    \/\/ other cases","    case .{lang}:","        return tree_sitter_{lang}()","    }","    \/\/ other cases","}"]},{"type":"paragraph","inlineContent":[{"type":"text","text":"On the bottom of the file add a new "},{"type":"codeVoice","code":"static"},{"text":" constant:","type":"text"}]},{"syntax":"swift","code":["static let {lang}: CodeLanguage = .init(","    id: .{lang}, ","    tsName: {lang}, ","    extensions: [...]",")"],"type":"codeListing"},{"style":"important","content":[{"type":"paragraph","inlineContent":[{"text":"In ‘extensions’ add the proper file extensions your language uses.","type":"text"}]}],"type":"aside","name":"Important"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Now find the static constant "},{"identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage\/allLanguages","type":"reference","isActive":true},{"type":"text","text":" and add your language to it:"}]},{"type":"codeListing","code":["static let allLanguages: [CodeLanguage] = [","    \/\/ other languages","    .{lang},","    \/\/ other languages","]"],"syntax":"swift"},{"anchor":"TreeSitterModelswift","type":"heading","text":"TreeSitterModel.swift","level":3},{"inlineContent":[{"type":"text","text":"Create a new query like so:"}],"type":"paragraph"},{"type":"codeListing","code":["public private(set) lazy var {lang}Query: Query? = {","    return queryFor(.{lang})","}()"],"syntax":"swift"},{"type":"paragraph","inlineContent":[{"text":"Find the ","type":"text"},{"isActive":true,"type":"reference","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterModel\/query(for:)"},{"text":" method and add a ","type":"text"},{"code":"case","type":"codeVoice"},{"text":" for your language:","type":"text"}]},{"type":"codeListing","code":["public func query(for language: TreeSitterLanguage) -> Query? {","    switch language {","    \/\/ other cases","    case .{lang}:","        return {lang}Query","    \/\/ other cases","    }","}"],"syntax":"swift"},{"level":2,"anchor":"Test-it","type":"heading","text":"Test it!"},{"type":"paragraph","inlineContent":[{"text":"Make sure to test the newly created language in a sample project!","type":"text"}]},{"inlineContent":[{"type":"text","text":"When everything is working correctly push your "},{"code":"tree-sitter-{lang}","type":"codeVoice"},{"type":"text","text":" changes to "},{"type":"codeVoice","code":"origin"},{"text":" and also create a Pull Request to the official repository.","type":"text"}],"type":"paragraph"},{"content":[{"type":"paragraph","inlineContent":[{"type":"text","text":"Take "},{"type":"reference","isActive":true,"identifier":"https:\/\/github.com\/tree-sitter\/tree-sitter-javascript\/pull\/223"},{"type":"text","text":" as a template and cross-reference it with your Pull Request."}]}],"type":"aside","style":"tip","name":"Tip"},{"type":"paragraph","inlineContent":[{"text":"Now you can remove the local dependencies and replace it with the actual package URLs and submit a Pull Request for ","type":"text"},{"type":"codeVoice","code":"CodeEditTextView"},{"type":"text","text":"."}]},{"level":2,"text":"Unit Tests","anchor":"Unit-Tests","type":"heading"},{"type":"paragraph","inlineContent":[{"type":"text","text":"Also make sure to add test cases for your new language in "},{"type":"codeVoice","code":"Tests\/CodeEditLanguagesTests"},{"type":"text","text":"."}]},{"level":3,"type":"heading","text":"Example","anchor":"Example"},{"code":["\/\/ MARK: - Swift","","    \/\/ create as many test cases as there are file extensions","    func test_CodeLanguageSwift() throws {","        let url = URL(fileURLWithPath: \"~\/path\/to\/file.swift\")","        let language = CodeLanguage.detectLanguageFrom(url: url)","","        XCTAssertEqual(language.id, .swift)","    }","","    func test_FetchQuerySwift() throws {","        var language = CodeLanguage.swift","        language.resourceURL = bundleURL","","        let data = try Data(contentsOf: language.queryURL!)","        let query = try? Query(language: language.language!, data: data)","        XCTAssertNotNil(query)","        XCTAssertNotEqual(query?.patternCount, 0)","    }"],"type":"codeListing","syntax":"swift"},{"anchor":"Run-Tests-locally","text":"Run Tests locally","level":3,"type":"heading"},{"type":"paragraph","inlineContent":[{"text":"Once you added your unit test cases run all tests locally on your machine by going to ","type":"text"},{"code":"Product>Test","type":"codeVoice"},{"type":"text","text":" or pressing "},{"code":"⌘+U","type":"codeVoice"},{"text":" to make sure everything is working as intended.","type":"text"},{"type":"text","text":" "},{"type":"image","identifier":"tests-results"}]},{"text":"Documentation","level":2,"anchor":"Documentation","type":"heading"},{"inlineContent":[{"text":"Please make sure to add the newly created properties to the documentation ","type":"text"},{"code":"*.md","type":"codeVoice"},{"type":"text","text":" files in the "},{"type":"codeVoice","code":"Documentation.docc"},{"text":" catalog.","type":"text"},{"type":"text","text":" "},{"identifier":"docs-location","type":"image"}],"type":"paragraph"}]}],"seeAlsoSections":[{"anchor":"Guides","generated":true,"identifiers":["doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/Update-Languages"],"title":"Guides"}],"variants":[{"paths":["\/documentation\/codeeditlanguages\/add-languages"],"traits":[{"interfaceLanguage":"swift"}]}],"schemaVersion":{"patch":0,"major":0,"minor":3},"kind":"article","sections":[],"abstract":[{"type":"text","text":"This article is a writedown on how to add support for more languages to "},{"type":"reference","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage","isActive":true},{"text":".","type":"text"}],"references":{"tests-results":{"alt":"unit test results","identifier":"tests-results","variants":[{"url":"\/images\/codeeditlanguages.CodeEditLanguages\/tests-results.png","traits":["1x","light"]}],"type":"image"},"doc://codeeditlanguages.CodeEditLanguages/documentation/CodeEditLanguages/Update-Languages":{"abstract":[{"text":"This article covers all the steps needed to update to the latest version of the ","type":"text"},{"code":"tree-sitter","type":"codeVoice"},{"type":"text","text":" languages."}],"type":"topic","kind":"article","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/Update-Languages","title":"Update Languages","role":"article","url":"\/documentation\/codeeditlanguages\/update-languages"},"doc://codeeditlanguages.CodeEditLanguages/documentation/CodeEditLanguages/TreeSitterModel/query(for:)":{"title":"query(for:)","kind":"symbol","role":"symbol","fragments":[{"kind":"keyword","text":"func"},{"kind":"text","text":" "},{"text":"query","kind":"identifier"},{"kind":"text","text":"("},{"kind":"externalParam","text":"for"},{"kind":"text","text":": "},{"kind":"typeIdentifier","preciseIdentifier":"s:17CodeEditLanguages18TreeSitterLanguageO","text":"TreeSitterLanguage"},{"kind":"text","text":") -> "},{"kind":"typeIdentifier","preciseIdentifier":"s:15SwiftTreeSitter5QueryC","text":"Query"},{"kind":"text","text":"?"}],"url":"\/documentation\/codeeditlanguages\/treesittermodel\/query(for:)","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterModel\/query(for:)","abstract":[{"text":"Get a query for a specific language","type":"text"}],"type":"topic"},"xcodeproj-location":{"identifier":"xcodeproj-location","alt":".xcodeproj location","type":"image","variants":[{"url":"\/images\/codeeditlanguages.CodeEditLanguages\/xcodeproj-location.png","traits":["1x","light"]}]},"doc://codeeditlanguages.CodeEditLanguages/documentation/CodeEditLanguages/CodeLanguage/allLanguages":{"abstract":[{"type":"text","text":"An array of all language structures."}],"role":"symbol","type":"topic","title":"allLanguages","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage\/allLanguages","kind":"symbol","url":"\/documentation\/codeeditlanguages\/codelanguage\/alllanguages","fragments":[{"kind":"keyword","text":"static"},{"text":" ","kind":"text"},{"text":"let","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"allLanguages"},{"text":": [","kind":"text"},{"text":"CodeLanguage","preciseIdentifier":"s:17CodeEditLanguages0A8LanguageV","kind":"typeIdentifier"},{"kind":"text","text":"]"}]},"build-output":{"identifier":"build-output","alt":"build_framework.sh console output","type":"image","variants":[{"traits":["1x","light"],"url":"\/images\/codeeditlanguages.CodeEditLanguages\/build-output.png"}]},"docs-location":{"identifier":"docs-location","alt":"docs location","type":"image","variants":[{"url":"\/images\/codeeditlanguages.CodeEditLanguages\/docs-location.png","traits":["1x","light"]}]},"https://github.com/tree-sitter/tree-sitter-javascript/pull/223":{"url":"https:\/\/github.com\/tree-sitter\/tree-sitter-javascript\/pull\/223","identifier":"https:\/\/github.com\/tree-sitter\/tree-sitter-javascript\/pull\/223","type":"link","titleInlineContent":[{"type":"text","text":"this PR description"}],"title":"this PR description"},"https://github.com/CodeEditApp/CodeEditTextView/issues/15":{"url":"https:\/\/github.com\/CodeEditApp\/CodeEditTextView\/issues\/15","identifier":"https:\/\/github.com\/CodeEditApp\/CodeEditTextView\/issues\/15","type":"link","titleInlineContent":[{"type":"text","text":"GitHub Issue"}],"title":"GitHub Issue"},"https://stedolan.github.io/jq/":{"url":"https:\/\/stedolan.github.io\/jq\/","identifier":"https:\/\/stedolan.github.io\/jq\/","type":"link","titleInlineContent":[{"type":"text","text":"here"}],"title":"here"},"doc://codeeditlanguages.CodeEditLanguages/documentation/CodeEditLanguages":{"role":"collection","type":"topic","title":"CodeEditLanguages","kind":"symbol","abstract":[{"text":"A collection of ","type":"text"},{"code":"tree-sitter","type":"codeVoice"},{"text":" languages for syntax highlighting.","type":"text"}],"identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages","url":"\/documentation\/codeeditlanguages"},"doc://codeeditlanguages.CodeEditLanguages/documentation/CodeEditLanguages/CodeLanguage":{"fragments":[{"text":"struct","kind":"keyword"},{"kind":"text","text":" "},{"kind":"identifier","text":"CodeLanguage"}],"navigatorTitle":[{"text":"CodeLanguage","kind":"identifier"}],"role":"symbol","type":"topic","title":"CodeLanguage","kind":"symbol","abstract":[{"type":"text","text":"A structure holding metadata for code languages"}],"identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/CodeLanguage","url":"\/documentation\/codeeditlanguages\/codelanguage"},"doc://codeeditlanguages.CodeEditLanguages/documentation/CodeEditLanguages/TreeSitterLanguage":{"url":"\/documentation\/codeeditlanguages\/treesitterlanguage","abstract":[{"text":"A collection of languages that are supported by ","type":"text"},{"type":"codeVoice","code":"tree-sitter"}],"fragments":[{"text":"enum","kind":"keyword"},{"text":" ","kind":"text"},{"text":"TreeSitterLanguage","kind":"identifier"}],"type":"topic","title":"TreeSitterLanguage","identifier":"doc:\/\/codeeditlanguages.CodeEditLanguages\/documentation\/CodeEditLanguages\/TreeSitterLanguage","role":"symbol","navigatorTitle":[{"kind":"identifier","text":"TreeSitterLanguage"}],"kind":"symbol"}}}